var R={propertiesMustMatch:!0,abortEarly:!1,cache:!0};function q(n,{validationHelpers:d={},rules:k,schema:o,errorMessages:v={},options:u=R}){u={...R,...u},n=n;let f={},i={},c={all:async e=>Promise.all([...e].map(async r=>await g(r,n))),first:async e=>{let r=[];for(let s of e){let l=await g(s,n);if(r.push(l),!l)return r}return r}};function y(e,r){if(!e||typeof r!="string")return;let s=r.split("."),l=e;for(let h of s){if(l[h]===void 0)return;l=l[h]}return l}async function g(e,r=null){if(o[e.key]){let{rule:s,required:l}=o[e.key];if((o[e.key]?.cache!==void 0?o[e.key].cache:u.cache)&&r[e.key]===i[e.key]?.value)return i[e.key].isValid;if((s&&l||!l&&e.value!="")&&s){let t=s.split("--")[0],m=s.split("--").length>1?s.split("--")[1]:"",E=P(e.value,k[t],m,d,r),{isValid:w,errorMessage:M,errorType:O}=await E.validate();return w||(f[e.key]={name:e.key,code:M,type:O,message:y(v,M)||""}),i[e.key]={isValid:w,value:r[e.key]},w}}else if(u.propertiesMustMatch)return f[e.key]={name:e.key,message:"Invalid property"},!1;return!0}async function V(e){return await g({key:e,value:n[e]},n)?{ok:!0}:{error:!0,errors:f[e]}}async function a(){f={};let e=Object.keys(n).map(r=>({key:r,value:n[r]}));if(e&&e.length>0){if(!Object.keys(o).every(t=>n.hasOwnProperty(t)))return{error:!0,errorMessage:"Missing properties"};if((u?.abortEarly?await c.first(e):await c.all(e)).some(t=>!t))return{error:!0,errors:f};let s=Object.keys(o).map(t=>({key:t,required:o[t].required})),l=e.map(t=>t.key);if(!s.filter(t=>t.required).map(t=>t.key).every(t=>l.includes(t)))return{error:!0}}else if(!e||e.length===0)return{error:!0,errorMessage:"Missing fields for schema"};return{ok:!0}}function p(e){n=e}return{validate:a,validateField:V,setData:p}}function P(n,d,k=null,o=null,v=null){async function u(i){let c,y;return{isValid:!(await Promise.all(i.validate.map(async a=>{let p=!0;if(i.params&&i.params[a]&&i.params[a].length>0){let e=i.params[a].map(s=>typeof s=="string"&&s[0]==="$"?s.substring(1,s.length):s);p=await this[a](...e)}else p=await this[a]();return!p&&!c&&i?.error[a]&&(c=i.error[a],y=a),p}))).some(a=>!a),errorMessage:c,errorType:y}}async function f(){if(o&&typeof o=="function"){let c=o(n,d,k,v);Object.keys(c).forEach(y=>{this[y]=c[y]})}return k?await u.call(this,d.modifier[k]):await u.call(this,d)}return{validate:f}}export{q as createValidator};
